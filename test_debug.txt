  console.error
    Staff password reset error: Error: DB down
        at Object.<anonymous> (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\__tests__\staff\staff-reset-password.test.ts:133:67)
        at Promise.finally.completed (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:1557:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:1497:10)
        at _callCircusTest (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:1007:40)
        at _runTest (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:947:3)
        at C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:849:7
        at _runTestsForDescribeBlock (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:862:11)
        at _runTestsForDescribeBlock (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:857:11)
        at run (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:761:3)
        at runAndTransformResultsToJestFormat (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\jestAdapterInit.js:1918:21)
        at jestAdapter (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-circus\build\runner.js:101:19)
        at runTestInternal (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-runner\build\index.js:275:16)
        at runTest (C:\Users\avnil\OneDrive\Desktop\AWT Project\mom_management\node_modules\jest-runner\build\index.js:343:7)

    [0m [90m 108 |[39m         })
     [90m 109 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 110 |[39m         console[33m.[39merror([32m'Staff password reset error:'[39m[33m,[39m error)
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 111 |[39m         [36mreturn[39m [33mNextResponse[39m[33m.[39mjson({ message[33m:[39m [32m'Failed to reset password'[39m }[33m,[39m { status[33m:[39m [35m500[39m })
     [90m 112 |[39m     }
     [90m 113 |[39m }[0m

      at POST (app/api/staff/[id]/reset-password/route.ts:110:17)
      at Object.<anonymous> (__tests__/staff/staff-reset-password.test.ts:139:21)

node.exe : FAIL __tes
ts__/staff/staff-rese
t-password.test.ts
At C:\Program Files\n
odejs\npx.ps1:29 
char:3
+   & $NODE_EXE 
$NPX_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~
    + CategoryInfo   
           : NotSpe  
  cified: (FAIL __   
 tests__/...asswo    
rd.test.ts:Strin    
g) [], RemoteExc    
eption
    + FullyQualified 
   ErrorId : Native  
  CommandError
 
  POST /api/staff/:id
/reset-password
    ├ù returns 400 
for NaN staff ID (6 
ms)
    ├ù returns 403 
for MEMBER role (1 
ms)
    ├ù returns 400 
for weak password 
(too short) (1 ms)
    ├ù returns 400 
for password without 
uppercase (1 ms)
    ├ù returns 400 
for password without 
digit (3 ms)
    ├ù returns 404 
when staff not in 
company (1 ms)
    ├ù returns 404 
when no linked user 
account (2 ms)
    ├ù resets 
password 
successfully with 
audit log (237 ms)
    ΓêÜ returns 500 
on unexpected error 
(18 ms)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 400 for 
NaN staff ID

    expect(received).
toBe(expected) // 
Object.is equality

    Expected: 
"Invalid staff ID"
    Received: 
undefined

    [0m [90m 17 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 18 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m400[3
9m)
    [31m[1m>[22m[
39m[90m 19 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoBe([32m'Inval
id staff ID'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 20 |[39m 
    })
     [90m 21 |[39m
     [90m 22 |[39m 
    it([32m'returns 
403 for MEMBER role'
[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:19:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 403 for 
MEMBER role

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 28 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 29 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m403[3
9m)
    [31m[1m>[22m[
39m[90m 30 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
Only Company 
Admins'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 31 |[39m 
    })
     [90m 32 |[39m
     [90m 33 |[39m 
    it([32m'returns 
400 for weak 
password (too short)'
[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:30:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 400 for 
weak password (too 
short)

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 39 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 40 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m400[3
9m)
    [31m[1m>[22m[
39m[90m 41 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
8 characters'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 42 |[39m 
    })
     [90m 43 |[39m
     [90m 44 |[39m 
    it([32m'returns 
400 for password 
without uppercase'[3
9m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:41:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 400 for 
password without 
uppercase

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 50 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 51 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m400[3
9m)
    [31m[1m>[22m[
39m[90m 52 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
uppercase'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 53 |[39m 
    })
     [90m 54 |[39m
     [90m 55 |[39m 
    it([32m'returns 
400 for password 
without digit'[39m[
33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:52:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 400 for 
password without 
digit

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 61 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 62 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m400[3
9m)
    [31m[1m>[22m[
39m[90m 63 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
digit'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 64 |[39m 
    })
     [90m 65 |[39m
     [90m 66 |[39m 
    it([32m'returns 
404 when staff not 
in company'[39m[33m
,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:63:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 404 when 
staff not in company

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 74 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 75 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m404[3
9m)
    [31m[1m>[22m[
39m[90m 76 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
not found'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 77 |[39m 
    })
     [90m 78 |[39m
     [90m 79 |[39m 
    it([32m'returns 
404 when no linked 
user account'[39m[3
3m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:76:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ returns 404 when 
no linked user 
account

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 90 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 91 |[39m 
        expect(res[3
3m.[39mstatus)[33m.
[39mtoBe([35m404[3
9m)
    [31m[1m>[22m[
39m[90m 92 |[39m   
      expect(body[33
m.[39mmessage)[33m.
[39mtoContain([32m'
No user 
account'[39m)
     [90m    |[39m 
                     
        
[31m[1m^[22m[39m
     [90m 93 |[39m 
    })
     [90m 94 |[39m
     [90m 95 |[39m 
    it([32m'resets 
password 
successfully with 
audit 
log'[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:92:30)

  ΓùÅ POST /api/staff
/:id/reset-password 
ΓÇ║ resets password 
successfully with 
audit log

    expect(received).
toContain(expected) 
// indexOf

    Matcher error: 
received value must 
not be null nor 
undefined

    Received has 
value: undefined

    [0m [90m 110 
|[39m         
[36mconst[39m body 
[33m=[39m 
[36mawait[39m 
parseResponse(res)
     [90m 111 
|[39m         expect
(res[33m.[39mstatus
)[33m.[39mtoBe([35
m200[39m)
    [31m[1m>[22m[
39m[90m 112 |[39m  
       expect(body[3
3m.[39mmessage)[33m
.[39mtoContain([32m
'John'[39m)
     [90m     
|[39m               
               
[31m[1m^[22m[39m
     [90m 113 |[39m
     [90m 114 
|[39m         
[90m// Verify 
password was 
hashed[39m
     [90m 115 
|[39m         
[36mconst[39m 
updateCall 
[33m=[39m (prisma[
33m.[39musers[33m.
[39mupdate 
[36mas[39m jest[33
m.[39m[33mMock[39m
)[33m.[39mmock[33m
.[39mcalls[[35m0[3
9m][[35m0[39m][0m

      at 
Object.<anonymous> (_
_tests__/staff/staff-
reset-password.test.t
s:112:30)

Test Suites: 1 
failed, 1 total
Tests:       8 
failed, 1 passed, 9 
total
Snapshots:   0 total
Time:        0.788 
s, estimated 1 s
Ran all test suites 
matching __tests__/st
aff/staff-reset-passw
ord.test.ts.
